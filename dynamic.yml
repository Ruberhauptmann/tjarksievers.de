# dynamic.yml

http:
  routers:
    dashboard:
      rule: "Host(`traefik.tjarksievers.de`)"
      service: "api@internal"
      middlewares:
        - "auth"
      tls:
        certResolver: "certresolver"
    nextcloud:
      rule: "Host(`nc.tjarksievers.de`)"
      entryPoints:
        - "websecure"
      service: nextcloud
      middlewares:
        - nextcloud-chain
      tls:
        certResolver: "certresolver"
  services:
    nextcloud:
      loadBalancer:
        servers:
          - url: "http://nextcloud-aio-mastercontainer:11000"
        passHostHeader: true

  middlewares:
    auth:
      basicAuth:
        users:
          - "tjark:$2y$05$jPwGv8D/GmohOqXvHAT43On2jdW3ToA1QD45jIjj4wB/RTJD2ZWHe"
    nextcloud-secure-headers:
      headers:
        hostsProxyHeaders:
          - "X-Forwarded-Host"
        referrerPolicy: "same-origin"
    https-redirect:
      redirectScheme:
        scheme: https
    nextcloud-chain:
      chain:
        middlewares:
          - https-redirect
          - nextcloud-secure-headers
